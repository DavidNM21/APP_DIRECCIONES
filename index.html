<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Tickets</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .form-group {
            margin-bottom: 10px;
        }
        label {
            display: block;
            margin-bottom: 5px;
        }
        input, textarea {
            width: 100%;
            padding: 8px;
        }
        button {
            padding: 10px 20px;
            margin-top: 10px;
        }
        #searchResult {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>Gestión de Tickets</h1>

    <!-- Formulario para ingresar datos -->
    <h2>Ingresar Ticket</h2>
    <div id="inputForm">
        <div class="form-group">
            <label for="folio">Folio:</label>
            <input type="text" id="folio" required>
        </div>
        <div class="form-group">
            <label for="cliente">Cliente:</label>
            <input type="text" id="cliente" required>
        </div>
        <div class="form-group">
            <label for="link">LINK de Google:</label>
            <input type="url" id="link" required>
        </div>
        <div class="form-group">
            <label for="comentarios">Comentarios:</label>
            <textarea id="comentarios" rows="4"></textarea>
        </div>
        <button onclick="saveTicket()">Guardar Ticket</button>
    </div>

    <!-- Formulario para buscar por folio -->
    <h2>Buscar Ticket por Folio</h2>
    <div id="searchForm">
        <div class="form-group">
            <label for="searchFolio">Folio:</label>
            <input type="text" id="searchFolio" required>
        </div>
        <button onclick="searchTicket()">Buscar</button>
    </div>

    <!-- Resultado de la búsqueda -->
    <div id="searchResult"></div>

    <script>
    // Reemplaza con la URL de tu script desplegado
    const scriptURL = 'https://script.google.com/macros/s/AKfycbw57JQ-EXU7FP2cdmftsATAlgltCoN8Dyoa3sNQQV8Vdn_wFUVrzBh8RzuaCdz3P1D8rQ/exec';

    // Función para guardar un ticket
    function saveTicket() {
  const folio = document.getElementById('folio').value.trim();
  const cliente = document.getElementById('cliente').value.trim();
  const link = document.getElementById('link').value.trim();
  const comentarios = document.getElementById('comentarios').value.trim();

  if (folio && cliente && link) {
    const data = { folio, cliente, link, comentarios };
    const button = document.querySelector('button[onclick="saveTicket()"]');
    button.disabled = true;

    fetch(scriptURL, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(data)
    })
    .then(response => {
      if (!response.ok) {
        throw new Error('Error en la respuesta del servidor: ' + response.status);
      }
      return response.json();
    })
    .then(result => {
      if (result.status === 'success') {
        alert('Ticket guardado exitosamente');
        document.getElementById('inputForm').reset();
      } else {
        alert('Error: ' + (result.error || 'Desconocido'));
      }
    })
    .catch(error => {
      console.error('Error:', error);
      alert('Error al guardar el ticket: ' + error.message);
    })
    .finally(() => {
      button.disabled = false;
    });
  } else {
    alert('Por favor, completa los campos obligatorios');
  }
}


    // Función para buscar un ticket
    function searchTicket() {
      const searchFolio = document.getElementById('searchFolio').value;
      fetch(`${scriptURL}?folio=${searchFolio}`)
      .then(response => response.json())
      .then(ticket => {
        const resultDiv = document.getElementById('searchResult');
        if (ticket.error) {
          resultDiv.innerHTML = '<p>No se encontró ningún ticket con ese folio.</p>';
        } else {
          resultDiv.innerHTML = `
            <h3>Ticket encontrado:</h3>
            <p><strong>Folio:</strong> ${ticket.folio}</p>
            <p><strong>Cliente:</strong> ${ticket.cliente}</p>
            <p><strong>LINK de Google:</strong> <a href="${ticket.link}" target="_blank">${ticket.link}</a></p>
            <p><strong>Comentarios:</strong> ${ticket.comentarios || 'N/A'}</p>
          `;
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('Error al buscar el ticket');
      });
    }
    </script>
</body>
</html>
